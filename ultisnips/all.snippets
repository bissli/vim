priority -60

# -----------------------------------------------------------
# => Helpers
# -----------------------------------------------------------
global !p

from vimsnippets import get_comment_format

def past_weekday(fmt):
	try:
		from tc import date
		pdate = date.to_date('P')
	except:
		from datetime import date, timedelta
		pdate = date.today() - timedelta(days=1)
		dnum = pdate.weekday()
		if dnum in (5, 6):
			pdate =  pdate - timedelta(days=dnum - 4)
	return pdate.strftime(fmt)

endglobal

# -----------------------------------------------------------
# => Dates
# -----------------------------------------------------------
snippet pd "YYYY-MM-DD" i
`!p snip.rv = t[1]``!p snip.rv = past_weekday("%Y-%m-%d")`${1:'} $0
endsnippet

snippet td "YYYY-MM-DD" "not re.match('<', snip.buffer[snip.line-1])" ie
`!p snip.rv = t[1]``!v strftime("%Y-%m-%d")`${1:'} $0
endsnippet

snippet dd "Month DD, YYYY" w
`!p snip.rv = t[1]``!v strftime("%b %d, %Y")`${1:'} $0
endsnippet

snippet di "ISO format datetime" w
`!v strftime("%Y-%m-%d %H:%M:%S%z")`
endsnippet

snippet t "hh:mm" w
`!v strftime("%H:%M")`
endsnippet

snippet dt "YYYY-MM-DD hh:mm" w
`!v strftime("%Y-%m-%d %H:%M")`
endsnippet

snippet todo "TODO comment" bw
`!p snip.rv=get_comment_format()[0]` ${2:TODO}: $0${3: <${4:`!v strftime('%m/%d/%y')`}${5:, `!v g:snips_author`}>} `!p snip.rv=get_comment_format()[2]`
endsnippet

# -----------------------------------------------------------
# general
# -----------------------------------------------------------
snippet lbr "line break" bw
=========================================== [`!p snip.rv = t[1]``!v strftime("%Y-%m-%d")`]
endsnippet

# -----------------------------------------------------------
# AI Prompts
# -----------------------------------------------------------
snippet ai-idea "Brainstorming Prompt"
Note: Use a conversational model like openai 4o/o3
======================================================================
/ask Ask me one question at a time so we can develop a thorough, step-by-step spec
for this idea. Each question should build on my previous answers, and our end
goal is to have a detailed specification I can hand off to a developer. Let's
do this iteratively and dig into every relevant detail. Remember, only one
question at a time.

Here's the idea:

<SPEC>
======================================================================
Now that we've wrapped up the brainstorming process, can you compile our
findings into a comprehensive, developer-ready specification \`spec.md\`?
Include all relevant requirements, architecture choices, data handling details,
error handling strategies, and a testing plan so a developer can immediately
begin implementation.
endsnippet

snippet ai-plan "Planning Prompt"
Note: Use a proper reasoning model (o1, o3, r1)
[TDD]
======================================================================
Draft a detailed, step-by-step blueprint for building this project. Then, once
you have a solid plan, break it down into small, iterative chunks that build on
each other. Look at these chunks and then go another round to break it into
small steps. Review the results and make sure that the steps are small enough
to be implemented safely with strong testing, but big enough to move the
project forward. Iterate until you feel that the steps are right sized for this
project.

From here you should have the foundation to provide a series of prompts for a
code-generation LLM that will implement each step in a test-driven manner.
Prioritize best practices, incremental progress, and early testing, ensuring no
big jumps in complexity at any stage. Make sure that each prompt builds on the
previous prompts, and ends with wiring things together. There should be no
hanging or orphaned code that isn't integrated into a previous step.

Make sure and separate each prompt section. Use markdown. Each prompt should be
tagged as text using code tags. The goal is to output prompts, but context, etc
is important as well.

[Non-TDD]
======================================================================
Draft a detailed, step-by-step blueprint for building this project. Then, once
you have a solid plan, break it down into small, iterative chunks that build on
each other. Look at these chunks and then go another round to break it into
small steps. review the results and make sure that the steps are small enough
to be implemented safely, but big enough to move the project forward. Iterate
until you feel that the steps are right sized for this project.

From here you should have the foundation to provide a series of prompts for a
code-generation LLM that will implement each step. Prioritize best practices,
and incremental progress, ensuring no big jumps in complexity at any stage.
Make sure that each prompt builds on the previous prompts, and ends with wiring
things together. There should be no hanging or orphaned code that isn't
integrated into a previous step.

Make sure and separate each prompt section. Use markdown. Each prompt should be
tagged as text using code tags. The goal is to output prompts, but context, etc
is important as well.


======================================================================

[ASK]

Ask me questions about this design so we can build a plan. Ask me one question at a time.

Review your plan and write a comprehensive plan that is cleanest and best designed.

[CODE]

Write the entire final draft to a document \`spec.md\`. Write only to \`spec.md\`.

Update the test code in spec.md to use pytest-mock with mocker. Do not use \`MagicMock\`

[TODO]
======================================================================

[ASK]

Can you make a \`todo.md\` that I can use as a checklist? Be thorough.

[CODE]

Write this output verbatim to todo.md. Write only to \`todo.md\`.

[EXECUTE]
======================================================================
Work through \`todo.md\` phase by phase. If there are completed checkboxes assume those changes are already implemented.
This \`todo.md\` references \`spec.md\`, so read spec.md thoroughly.
Be sure to comlete the checkboxes in todo.md after completing the phase implementation.
IMPORTANT: After completing the checkboxes of the phase in \`todo.md\` STOP and ask me whether to continue.
IMPORTANT: Do not deviate from the \`todo.md\` or \`spec.md\` and only work on the plan. Do not create or modify any other code.

endsnippet

snippet ai-debug "Debugging Prompt"

[Ask]

This file has some code issues. First tell me which files you need to see in order to diagnose. Then STOP.

[Ask]

Will this pass the test? Critique your approach.

endsnippet

snippet ai-review "Code Review Prompt"
[Basic]
======================================================================
You are a senior developer. Your job is to do a thorough code review of this
code. You should write it up and output markdown. Include line numbers, and
contextual info. Your code review will be passed to another teammate, so be
thorough. Think deeply before writing the code review. Review every part, and
don't hallucinate.

[GitHub Issues]
======================================================================
You are a senior developer. Your job is to review this code, and write out the
top issues that you see with the code. It could be bugs, design choices, or
code cleanliness issues. You should be specific, and be very good. Do Not
Hallucinate. Think quietly to yourself, then act - write the issues. The issues
will be given to a developer to executed on, so they should be in a format that
is compatible with github issues.

[Tests]
======================================================================
You are a senior developer. Your job is to review this code, and write out a
list of missing test cases, and code tests that should exist. You should be
specific, and be very good. Do Not Hallucinate. Think quietly to yourself, then
act - write the issues. The issues will be given to a developer to executed on,
so they should be in a format that is compatible with github issues.
endsnippet
